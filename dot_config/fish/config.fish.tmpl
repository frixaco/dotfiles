set -g fish_greeting

set -gx EDITOR nvim

# for Lazygit config to work
set -gx XDG_CONFIG_HOME "$HOME/.config"

fish_add_path ~/.local/bin ~/.bun/bin ~/.amp/bin ~/.opencode/bin

alias l="eza --color=always --icons --all --long --time modified --sort modified --no-permissions --octal-permissions --git --smart-group --git-repos"
alias v="nvim"
alias en="cd ~/.config/nvim && nvim"
alias sf="source ~/.config/fish/config.fish"
alias c="clear"
alias ef="nvim ~/.config/fish/config.fish"
alias cc="claude"
alias oc="opencode"
# alias amp="bunx @sourcegraph/amp --ide"
# alias opencode="bunx opencode-ai"
# alias claude="bunx @anthropic-ai/claude-code"
# bun i -g @openai/codex
alias pi="bunx @mariozechner/pi-coding-agent"
alias se="source .venv/bin/activate.fish"

function ccd
    cd $(chezmoi source-path)
end

{{- if eq .chezmoi.os "linux" }}
{{ 	if (.chezmoi.kernel.osrelease | lower | contains "microsoft") }}
function copy-to-desktop --description 'Copy file(s) to WSL Desktop (/mnt/c/Users/frixa/Desktop)'
    if test (count $argv) -eq 0
        echo "Usage: copy-to-desktop <file1> [file2 ...]"
        return 1
    end
    
    set target_dir "/mnt/c/Users/frixa/Desktop"
    
    if not test -d $target_dir
        echo "Error: Desktop directory not found: $target_dir"
        return 1
    end
    
    for file in $argv
        if test -e $file
            cp $file $target_dir
            echo "Copied: $file -> $target_dir/"
        else
            echo "Error: File not found: $file"
        end
    end
end
{{- 	end }}
{{- end }}

function envsource
    if not test -f $argv[1]
        echo "Error: File $argv[1] not found"
        return 1
    end

    while read -l line
        # Skip comments and empty lines
        if string match -qv '#*' $line; and string length -q (string trim $line)
            set -l item (string split -m 1 '=' $line)
            if test (count $item) -eq 2
                set -gx $item[1] (string trim -c '"\'' $item[2])
            end
        end
    end < $argv[1]
end

function g
  set -l original_dir (pwd)

  lazygit $argv

  cd $original_dir
end

function y
	set tmp (mktemp -t "yazi-cwd.XXXXXX")
	yazi $argv --cwd-file="$tmp"
	if read -z cwd < "$tmp"; and [ -n "$cwd" ]; and [ "$cwd" != "$PWD" ]
		builtin cd -- "$cwd"
	end
	rm -f -- "$tmp"
end

if test -f ~/.config/fish/env.fish 
  source ~/.config/fish/env.fish
end

zoxide init fish | source
starship init fish | source
fzf --fish | source
mise activate fish | source
{{ if and .work (eq .chezmoi.os "darwin") -}}
rbenv init - fish | source
{{- end -}}
